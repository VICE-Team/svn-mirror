2002-05-20  Andreas Boose  <viceteam@t-online.de>

	* Version 1.9.19.

	* keyboard.c, keyboard.h, arch/unix/x11/kbd.c,
	arch/unix/x11/x11kbd.c, arch/unix/kbd.h: Rewritten for generic
	keyboard support.

	* c128/c128mmu.c, arch/win32/kbd.c, arch/msdos/kbd.c,
	arch/riscos/kbd.c, arch/os2/kbd/proc.c, arch/beos/kbd.c,
	c128/c128mem.c, arch/unix/uisettings.c: Cosmetic changes.

	* c64/c64cia1.c, c128/c128cia1.c, vic20/vic20via1.c,
	vic20/vic20via2.c, pet/petmem.c, pet/petpia1.c, pet/petvia.c,
	cbm2/c610cia1.c, cbm2/c610mem.c, cbm2/c610tpi2.c,
	arch/unix/x11/gnome/ui.c, arch/unix/x11/gnome/gnomekbd.c,
	arch/unix/x11/xaw/x11kbd.c: Do not include #include "kbd.h".

	* arch/unix/x11/kbdef.h, arch/unix/x11/x11kbd.c,
	arch/unix/x11/x11kbd.h: Removed.

	* arch/unix/x11/Makefile.am: Updated.

	* arch/unix/x11/dga2.c, arch/unix/x11/fullscreen.c,
	arch/unix/x11/gnome/gnomekbd.c, arch/unix/x11/xaw/x11kbd.c:
	Include "kbd.h" instead of "x11kbd.h".

	* arch/msdos/vsync.c: Changed "clk" to "main_clk".

	* arch/msdos/console.c, arch/msdos/ui.c:
	#include "videoarch.h".

	* arch/msdos/uimon.c: #include "utils.h".

	* arch/msdos/c64kbd.c, arch/msdos/c128kbd.c,
	arch/msdos/vic20kbd.c, arch/msdos/petkbd.c,
	arch/msdos/plus4kbd.c, arch/msdos/c610kbd.c: Those hardcoded
	tables are not needed if `COMMON_KBD' is defined.

	* arch/msdos/kbd.c, arch/msdos/kbd.h: Added support for common
	keyboard code.

	* arch/unix/kbd.h, arch/msdos/kbd.h, arch/win32/kbd.h,
	arch/riscos/kbd.h, arch/os2/kbd.h, arch/beos/kbd.h: Added
	prototypes and default kbd file names.

	* c64/c64-resources.c, c128/c128-resources.c,
	vic20/vic20-resources.c, pet/pet-resources.c,
	plus4/plus4-resources.c, cbm2/c610-resources.c: Use kbd file
	names specified in `kbd.h'.

	* vice.h: Define `COMMON_KBD' for msdos.

	* resources.c (resources_set_defaults): Removed debugging
	output.

2002-05-19  Andreas Boose  <viceteam@t-online.de>

	* Version 1.9.18.

	* vice.h: Define `COMMON_KBD' for Unix systems.

	* keyboard.c, keyboard.h (keyboard_set_keyarr): Random
	keypress delay.  (keyboard_set_keymap_file): New function.

	* arch/msdos/kbd.c (kbd_install): Use
	`keyboard_clear_keymatrix()'.

	* c64/c64-resources.c, c128/c128-resources.c,
	vic20/vic20-resources.c, pet/pet-resources.c,
	plus4/plus4-resources.c, cbm2/c610-resources.c:

	* c64/c64-cmdline-options.c, c128/c128-cmdline-options.c,
	vic20/vic20-cmdline-options.c, pet/pet-cmdline-options.c,
	plus4/plus4-cmdline-options.c, cbm2/c610-cmdline-options.c

	* machine.h, c64/c64.c, c128/c128.c, vic20/vic20.c, pet/pet.c,
	plus4/plus4.c, cbm2/c610.c (machine_num_keyboard_mappings):
	New function.

	* resources.c, resources.h (resources_set_defaults): Return
	error value if resource could not be set.

	* main.c (MAIN_PROGRAM): Abort if `resources_set_defaults()'
	has failed.

	* initcmdline.c (cmdline_default): Likewise.

	* plus4/plus4-resources.c: Added `MachineVideoStandard'.

	* arch/unix/Makefile.am: Removed `kmap.c' and `petkmap.c'.

	* arch/unix/x11/kbd.c: Removed resource code.

	* sid/sid-resources.c, sid/sid-resources.h,
	c64/c64-resources.c, c128/c128-resources.c,
	cbm2/c610-resources.c: Moved SID stereo address to machine
	specific respources.

	* sid/sid-resources.h, cmdline.h, cmdline.c, keyboard.h,
	vicii/vicii-cmdline-options.c, vdc/vdc-cmdline-options.c,
	crtc/crtc-cmdline-options.c, vic20/vic-cmdline-options.c,
	drive/drive-cmdline-options.c, arch/unix/x11/vidmode.h,
	c64/c64-cmdline-options.c, c128/c128-cmdline-options.c,
	pet/pet-cmdline-options.c, cbm2/c610-cmdline-options.c,
	plus4/plus4-cmdline-options.c, sid/sid-cmdline-options.c,
	fullscreen.h, arch/unix/x11/ui-cmdline-options.c: Use
	`void *' for resource value.

2002-05-17  Andreas Boose  <viceteam@t-online.de>

	* Version 1.9.17.

	* raster/raster-line.c (raster_line_emulate): Do not calculate
	sprite collisions twice.

2002-05-17  Andreas Matthies  <andreas.matthies@gmx.net>

	* Makefile.am: Added rule for libimagecontents.

	* arch/beos/ui.cc, ui_file.cc: Renamed calls to tape_image_*.

2002-05-13  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/win32/joystick.c: Renamed clk.

	* vicii/vicii-mem.c (store_d016): Don't set xsmooth_shift_left
	in the last column.

2002-05-12  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/win32/ui.c: Use autostart_index instead of
	autostart_filename to feed ui_select_file with.

	* arch/win32/uilib.c: Removed obsolete get_filename_from_*
	stuff. autostart_result is an integer now, determined
	by the index of the content list selection.

	* arch/win32/uilib.h: Changed prototype of ui_select_file.

2002-05-12  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.16.

	* vicii/vicii.c (vic_ii_update_memory_ptrs): Use
	`chargen_rom_ptr'.

	* c64/c64mem.c, c64/c64mem.h, c128/c128mem.c, cbm2/c610mem.c:
	Added `chargen_rom_ptr'.

	* c128/c128mem.h: Increased `C128_CHARGEN_ROM_SIZE'.

	* c128/c128mem.c (store_zero): Handle pending alrams.
	(pla_config_changed): Update video memory pointers.

	* c128/c128memlimit.c [limit_tab]: Turned off acceleraton for
	chargen ROM access.

	* c64/c64pla.c, c64/c64pla.h: Take pullup value.

	* drive/drive.h, machine.h, vicii/vicii.c, c64/c64.c,
	c64/psid.c, c128/c128.c, vic20/vic.c, vic20/vic20.c,
	vic20/vic20mem.c, plus4/plus4.c, plus4/ted.c, drive/drive.c,
	arch/unix/c128ui.c, arch/unix/c610ui.c, arch/unix/c64ui.c,
	arch/unix/plus4ui.c, arch/unix/uipalemu.c,
	arch/unix/vic20ui.c, arch/unix/vsidui.c, arch/win32/ui.c,
	arch/win32/vsidui.c, arch/msdos/c128ui.c, arch/msdos/c64ui.c,
	arch/msdos/vic20ui.c, arch/msdos/vsidui.c, arch/os2/vsidui.c,
	arch/riscos/uiconfig.c, arch/riscos/vsync.c,
	arch/os2/dialogs/menubar.c, drive/drive-cmdline-options.c,
	drive/drive-resources.c, arch/beos/ui.cc, arch/beos/vsidui.cc,
	c64/c64-resources.c, c128/c128-resources.c,
	vic20/vic20-resources.c, plus4/plus4-resources.c,
	c64/c64-cmdline-options.c, c128/c128-cmdline-options.c,
	vic20/vic20-cmdline-options.c, plus4/plus4-cmdline-options.c:
	Moved video standard settings from drive to machine.

	* interrupt.c, interrupt.h: Removed cruft.

	* maincpu.c, maincpu.h, vicii/vicii-mem.c, vicii/vicii.c,
	sid/sid.c, c64/c64cia1.c, c64/c64cia2.c, c64/c64tpi.c,
	c64/c64acia1.c, c64/cart/c64cartmem.c, c128/c128cia1.c,
	vic20/vic20via1.c, vic20/vic20via2.c, vic20/vic20ieeevia1.c,
	vic20/vic20ieeevia2.c, pet/petacia1.c, pet/petpia1.c,
	pet/petpia2.c, pet/petvia.c, plus4/ted-mem.c,
	plus4/plus4acia.c, cbm2/c610acia1.c, cbm2/c610cia1.c,
	cbm2/c610tpi1.c, cbm2/c610tpi2.c: Renamed `rmw_flag'.

	* maincpu.c, maincpu.h, vdc/vdc.c, crtc/crtc-mem.c,
	crtc/crtc-snapshot.c, crtc/crtc.c, sid/fastsid.c, sid/sid.c,
	c64/c64iec.c, c64/c64tpi.c, c128/c128iec.c, vic20/vic-mem.c,
	vic20/vic-snapshot.c, vic20/vic.c, vic20/vic20sound.c,
	vic20/vic20ieeevia1.c, vic20/vic20ieeevia2.c, pet/petvia.c,
	plus4/plus4iec.c, plus4/tcbm.c, plus4/ted-sound.c,
	plus4/ted-timer.c, cbm2/c610tpi1.c, cbm2/c610tpi2.c,
	datasette.c, kbdbuf.c, keyboard.c, parallel.c, sound.c,
	vsync.c, interrupt.h, drive/drive.c, drive/drivecpu.c,
	vicii/vicii-mem.c, vicii-snapshot.c, vicii/vicii.c,
	c64/cart/c64cart.c, c64/c64.c, c64/c64cia1.c, c64/c64cia2.c,
	c64/reu.c, c64/c64acia1.c, 6510core.c, c128/z80.c,
	vic20/vic20via1.c, vic20/vic20via2.c, pet/petacia1.c,
	pet/petpia1.c, pet/petpia2.c, pet/petpia2.c, plus4/plus4.c,
	plus4/ted-mem.c, plus4/ted-snapshot.c, plus4/ted.c,
	plus4/plus4acia.c, cbm2/c610.c, cbm2/c610acia1.c, autostart.c,
	interrupt.c, rsuser.c: Renamed `clk'.

2002-05-11  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.15.

	* tape/tape.c (tape_seek_start, tape_seek_to_file): New
	functions.

	* tape/tap.c (tap_seek_to_file): New function.
	(tap_read_byte, tap_read_header): Added checksum support.

	* autostart.c (autostart_tape): Seek to selected file if a
	TAP image is attached.

	* machine.c, c64/c64.c, c128/c128.c, vic20/vic20.c, pet/pet.c,
	plus4/plus4.c, cbm2/c610.c: Reset autostart in `machine.c'.

	* datasette.c (datasette_internal_reset): Only rewind tape if
	there is no autostart in progress.

	* tape/t64.c, t64.h (t64_rewind): Renamed.

	* c64/c64.c, c128/c128.c, vic20/vic20.c, pet/petmem.c,
	plus4/plus4.c, cbm2/c610mem.c [tapeinit]: Increased long pulse
	max to 100 cycles.

2002-05-11  Andreas Matthies  <andreas.matthies@gmx.net>

	* imagecontents/tapecontents.c (image_contents_read_tape):
	Return if tape_image is NULL.

	* tape/tape.c (tape_internal_open_tape_image):
	Free image if open wasn't successful.

	* tape/tap.c: Corrected TAP_PILOT_HEADER_MIN.

2002-05-11  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/win32/imagecontents.dsp: Introduced again.

	* arch/win32/Makefile.am: Added imagecontents.dsp.

	* tape/tapeimage.c (tape_image_open): Reset initial
	read_only flag before opening as a tap.

2002-05-10  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.14.

	* tape/tape.c, tape.h, c64/c64.c, c128/c128.c, vic20/vic20.c,
	pet/petmem.c, plus4/plus4.c, cbm2/c610mem.c (tape_init): Pass
	pointer to struct instead if lots of variables.  Added tape
	pulse lengths.

	* init.c, c64/c64.c, c128/c128.c, vic20/vic20.c, pet/pet.c,
	plus4/plus4.c, cbm2/c610.c: Init main CPU by `init.c'.

	* tape/tapeimage.c (tape_image_detach): Skip if pointer to
	`struct tape_image_s' is `NULL'.

	* tape/tap.c (tap_search_header_pilot): Optimized for speed.
	(tap_init): New function.

2002-05-10  Tibor Biczo  <crown@axelero.hu>

	* arch/win32/base.dsp: Removed imagecontents.c.

	* arch/win32/imagecontents.dsp: New MSVC project file.

	* arch/win32/resid.dsp, arch/win32/sid.dsp: Updated project
	files for Visual Studio .NET compatibility.

	* arch/win32/tape.dsp: Added tapeimage.c.

	* arch/win32/vice.dsw: Added imagecontents.dsp project.

2002-05-09  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.13.

	* tape/tapeimage.c, imagecontents/tapecontents.c,
	tape/tape.c, tape.h, tape/tap.c, tap.h: Rewritten to support
	generic tape access.

	* tap.h, tape/tap.c (tap_open): Support for read only flag.

	* t64.h, tape/t64.c (t64_open): Changed likewise.

	* c1541.c (tape_cmd): Added read only flag.

	* datasette.c (datasette_internal_reset): Use
	`tap_seek_start()'.

2002-05-08  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.12.

	* imagecontents/Makefile.am, imagecontents/diskcontents.c,
	imagecontents/imagecontents.c, imagecontents/tapecontents.c,
	tape/tapeimage.c, tape/tapeimage.h: New files.

	* imagecontents.c: Moved to `imagecontents' directory.

	* tape/tape.c: Moved tape image specific code to
	`tapeimage.c'.

	* Makefile.am, tape/Makefile.am: Updated.

	* autostart.c, initcmdline.c, tape/tapeimage.c, tape.h,
	arch/unix/uicommands.c, arch/win32/ui.c, arch/riscos/ui.c,
	arch/msdos/menudefs.c, arch/os2/dialogs/dlg-fileio.c:
	Renamed `tape_attach_image()' to `tape_image_attach()'.

	* tape/tape.c, tape/tapeimage.c, tape.h, c64/c64.c,
	c128/c128.c, vic20/vic20.c, pet/pet.c, plus4/plus4.c,
	cbm2/c610.c, arch/unix/uicommands.c, arch/win32/ui.c,
	arch/msdos/menudefs.c, arch/riscos/ui.c,
	arch/os2/dialogs/menubar.c, arch/os2/dialogs/dlg-datasette.c:
	Renamed `tape_detach_image()' to `tape_image_detach()'.

2002-05-07  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/win32/raster.dsp: Added new file.

2002-05-06  pottendo  <pottendo@utanet.at>

	* main.c (MAIN_PROGRAM): Call fullscreen specific initialization
	just for dga2.

	* fullscreen.h: Include `x11/fullscreen-common.h'.

	* arch/unix/x11/xaw/ui.c: all reworked all dga2 specific cases to
	check `USE_XF86_DGA2_EXTENSIONS' instead of
	`USE_XF86_EXTENSIONS'. 
	* arch/unix/x11/gnome/ui.c: ditto.

	* arch/unix/x11/vidmode.c (vidmode_available): New function.

	* arch/unix/x11/fullscreen-common.c: New file. Implementation of
	common stuff for Unix fullscreen.
	* arch/unix/x11/fullscreen-common.h: New file.

	* arch/unix/x11/dga2.c (dga2_available): New function. 

	* arch/unix/x11/Makefile.am (EXTRA_libx11ui_a_SOURCES): Added
	`fullscreen-common.[ch]'. 

	* arch/unix/main_exit.c (main_exit): Call `fullscreen_mode_exit()'
	just for DGA2,

	* arch/unix/uicommands.c:
	callback activate_monitor: ditto.
	callback run_c1541: ditto.

2002-05-06  Matti Hamalainen  <mhamalai@ratol.fi>

	* petcat.c: Added FC3 support.

2002-05-06  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.11.

	* autostart.c (disk_eof_callback): Do not generate output if
	`AUTOSTART_NONE' is active.  (autostart_reset): do not eof
	callback if `AUTOSTART_DONE' is active.

	* keyboard.c: Use new macro `KEYBOARD_RAND()'.

	* video/video-render.c: Include stdio.h instead of stdlib.h.

2002-05-06  Thomas Bretz  <tbretz@physik.tu-muenchen.de>

	* arch/os2/install.cmd:
	- changed URL for vice_toc.html

	* arch/os2/makedist.cmd:
	- added 3plus1hi, 3plus1lo and dos1551

	* arch/os2/vac++/incl/mainsrc.icc:
	- added debug.c, init.c and initcmdline.c

	* arch/os2/vac++/incl/raster.icc:
	- added raster-line.c

	* arch/os2/vac++/RESID.ICC:
	- updated version number

	* arch/os2/video.c:
	- removed setting vide_draw_buffer_callback

	* plus4/plus4-resources.c:
	- renamed ram_size to ram_size_plus4

	* raster/raster-line.c:
	- added comment

	* vsyncapi.h:
	- added forwar declaration for canvas_s

2002-05-05  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.10.

	* drive/drive.c (drive_set_last_read): Call gcr writeback
	before moving head.

2002-05-05  pottendo  <pottendo@utanet.at>

	* video/video-render.c: #include <stdlib.h> for a definition
	of `NULL'.

	* fullscreen.h: Changed type from `fs_selected_videomode' to
	`int'.

	* arch/unix/x11/vidmode.c: New file. Support for resolution
	switching within Vice.
	* arch/unix/x11/vidmode.h: New file.

	* arch/unix/x11/videoarch.h: New interface
	`fullscreen_create_menus()'. 

	* arch/unix/x11/ui-resources.c: Reworked fullscreen resources.

	* arch/unix/x11/gnome/ui.c (ui_create_dynamic_menues): Moved
	code into dga2.c and vidmod.c.
	(ui_init_finish): Call `vidmode_init()'.
	* arch/unix/x11/xaw/ui.c: ditto.

	* arch/unix/x11/dga2.c: Added support for choosing different
	resolutions. 

	* arch/unix/x11/Makefile.am (EXTRA_libx11ui_a_SOURCES): Added
	`vidmode.[ch]' 

	* arch/unix/uisettings.c: Reworked fullscreen menus.

2002-05-02  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.9.

	* vicii/viciitypes.h: Added `screen_base' to struct `vic_ii'.

	* vicii/vicii.c (vic_ii_update_memory_ptrs): Update
	`screen_base'.
	(vic_ii_fetch_matrix): Changed to use `screen_base'.

	* vicii/vicii-sprites.c: Some reorganization.

2002-05-01  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.8.

	* vicii/vicii.c (vic_ii_update_memory_ptrs,
	handle_fetch_sprite): Removed `skip_frame' hack.

	* vicii/vicii-mem.c (vic_ii_local_store_vbank): Likewise.

	* raster/raster-canvas.c, raster/raster-canvas.h: New files.

	* raster/Makefile.am: Added new files.

	* raster/raster-line.c (add_line_to_area): Fixed calculation
	of area to update.
	Moved canvas specific code to `raster/raster-canvas.c'.

	* raster/raster.h: Removed `skip_frame' hacks.
	Removed obsolete `vid_*' functions.

	* raster/raster.c (add_line_and_double_scan): Removed, changed
	calls to use `add_line_to_area()' instead.
	Moved canvas specific code to `raster/raster-canvas.c'.

	* crtc/crtc.c (crtc_raster_draw_alarm_handler): Renamed call
	to `raster_canvas_handle_end_of_frame()'.

	* video/video-render.c (video_refresh_all): Likewise.

	* raster/raster.c, raster/raster-line.c, vicii/vicii-draw.c,
	vdc/vdc-draw.c, crtc/crtc-draw.c, vic20/vic-draw.c,
	plus4/ted-draw.c: Call `memset' and `memcpy' directly.

	* vic20/vic.h: Moved definition of `RASTER_PIXEL*' to here.

2002-05-01  Andreas Matthies  <andreas.matthies@gmx.net>

	* vicii/vicii-draw.c (draw_mc_text_foreground),
	(draw_mc_bitmap_foreground): Don't use background_color
	but the value peeked before DRAW_MC_BYTE to restore
	the background behind the cropped area.

2002-04-30  Andreas Matthies  <andreas.matthies@gmx.net>

	* vicii/vicii-draw.c (draw_std_text_foreground): We only have
	to check for xsmooth_shift_left > 0, then we're always on
	the last char.
	(draw_mc_text_foreground), (draw_mc_bitmap_foreground),
	(draw_ext_text_foreground), (draw_idle_foreground) now handle
	the xsmooth_shift_left case.

2002-04-29  Andreas Matthies  <andreas.matthies@gmx.net>

	* autostart.c (autostart_advance): Even if READY prompt
	doesn't appear the orig_drive_true_emulation_state has
	to be set to be resetted correctly later.
	(autostart_prg): Don't disable true drive emulation as
	it is done later in autostart_advance.

	* vicii/vicii.c (vic_ii_reset): Call vic_ii_reset_registers.
	(vic_ii_reset_registers): Return immediately if vic_ii is
	not initialized.

2002-04-29  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.7.

	* vicii/vicii-draw.c: Added numerous new drawing functions for
	all invalid modes.
	(setup_single_size_modes): Register new functions.

2002-04-28  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.6.

	* vicii/viciitypes.h: Replaced `hires_background_color' by
	`background_color_source' in struct `vic_ii_s'.

	* vicii/vicii.c (vic_ii_update_video_mode,
	vic_ii_fetch_matrix): Added support for extented text mode
	xsmooth.

	* vicii/vicii-draw.c (draw_std_background): Rewritten to
	support both hires bitmap and extended text mode xsmooth.

2002-04-27  Andreas Matthies  <andreas.matthies@gmx.net>

	* vicii/vicii.c (vic_ii_raster_draw_alarm_handler): Reset
	xsmooth_shift_left before emulating the line.

2002-04-27  Robert Bäuml  <robert.baeuml@gmx.net>

	* arch/unix/joystick.c (new_joystick_init): Fixed some typo.

2002-04-27  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.5.

	* raster/raster.h: New member xsmooth_shift_right in raster_s.

	* raster/raster.c (raster_reset): Init xsmooth_shift_right.

	* vicii/vicii-mem.c (store_d016): Trigger a background change
	if scrolling to the right.

	* vicii/vicii-draw.c (draw_std_background): Set the background
	color source to the currently active vbuf value if hires
	bitmap mode is enabled.

2002-04-27 Andreas Matthies <andreas.matthies@gmx.net>

	* raster/raster.h: New member xsmooth_shift_left in raster_s.

	* raster/raster.c (raster_reset): Init xsmooth_shift_left.

	* raster/raster-line.c (handle_visible_line_with_changes):
	Reset xsmooth_shift_left after each
	raster_mode_draw_foreground.

	* vicii/vicii-draw.c (draw_std_text_foreground): Cut
	xsmooth_shift_left pixels of the last char.

	* vicii/vicii-mem.c (store_d016): Set xsmooth_shift_left via
	raster_add_int_change_foreground.

2002-04-26  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.4.

	* raster/raster-line.c (fill_background): New function.

2002-04-25  Andreas Matthies  <andreas.matthies@gmx.net>

	* vicii/vic-mem.c (store_d016): Use
	raster_add_int_change_foreground to set new xsmooth.

2002-04-24  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/win32/diskimage.dsp, tape.dsp: New files.

	* arch/win32/Makefile.am: Added new files.

	* arch/win32/base.dsp, c1541.dsp: Removed files of new
	libraries.

	* arch/win32/vice.dsw: Added new projects diskimage, tape.
	Updated dependencies.

2002-04-23  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.3.

	* c64/cart/c64cartmem.c, c64/cart/c64cartmem.h
	(cartridge_config_changed): Added write mode flag.

	* c64/cart/actionreplay.c, c64/cart/atomicpower.c,
	c64/cart/epyxfastload.c, c64/cart/expert.c, c64/cart/final.c,
	c64/cart/generic.c, c64/cart/kcs.c, c64/cart/retroreplay.c,
	c64/cart/supergames.c, c64/cart/supersnapshot.c,
	c64/cart/zaxxon.c: Use `cartridge_config_changed()' with write
	mode flag.

	* vicii/vicii.c, vicii/vicii.h
	(vic_ii_handle_pending_alarms_external): New function.

	* c64/c64.c, c64/c64cia1.c, c64/c64cia2.c, c128/c128cia1.c,
	c128/c128mmu.c: Use `vic_ii_handle_pending_alarms_external()'.

2002-04-21  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.2.

	* tape/tape.c: Use `CAS_TYPE_BAS'.

	* vdrive/vdrive.h, vdrive/vdrive.c (vdrive_set_last_read,
	vdrive_get_last_read): New functions.

	* vdrive/vdrive-iec.c (vdrive_iec_open, vdrive_iec_read): Set
	last read track, sector and buffer.

	* autostart.c (disk_eof_callback): Get and set last track,
	sector and buffer read.

	* drive/drive.c (drive_set_last_read): New function.

	* diskimage/Makefile.am, diskimage/createdisk.c,
	diskimage/createdisk.h, diskimage/diskimage.c,
	diskimage/probe.c, diskimage/probe.h, diskimage/x64.h,
	diskconstants.h, tape/Makefile.am: New files.

	* diskimage.c, t64.c, tap.c, tape.c: Moved around.

	* vdrive/vdrive.h: Moved disk constants to other file.

	* drive/drive-snapshot.c, drive/drive.c, vdrive/vdrive-bam.c,
	vdrive/vdrive-dir.c, vdrive/vdrive.c: Fixed includes.

2002-04-20  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.1.

	* interrupt.h (interrupt_steal_cycles): Fixed calculation of
	`last_stolen_cycles_clk'.  Removed some cruft.

	* vicii/vicii-mem.c, vicii/vicii.c, plus4/ted.c: Adopted call
	to `interrupt_steal_cycles()' to new interface.

2002-04-19  Andreas Matthies  <andreas.matthies@gmx.net>

	* c64/c64mem.c (pla_config_changed): The caps sense flag has
	to be bypassed with current value.

2002-04-19  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9a.

	* vsync.c (vsync_do_vsync) [WIN32]: Only use vblank sync if
	frame rate is 50Hz.

2002-04-14  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.9.

2002-04-14  John Selck  <graham@cruise.de>

	* arch/win32/resc128.rc: Added "PAL Emulation" entry
	to menu.

	* arch/win32/c128ui.c: Added "PAL Emulation" entry
	to c128_ui_menu_toggles[].

	* vic20/vic-color.c: Increased VIC_SATURATION from
	48 to 80.

2002-04-13  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.38.

	* arch/unix/x11/gnome/ui.c (ui_open_canvas_window): Commented
	out call to `gtk_rc_style_unref()'.

2002-04-12  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/msdos/c128ui.c, c64ui.c, vic20ui.c: Fixed PAL resource.
	Added menuitem and handler for PAL Mode.

	* arch/msdos/vsync.c (vsync_do_vsync): Fixed signature.

	* arch/win32/resvic.rc: Fixed text of PAL menuitem.

2002-04-11  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.37.

2002-04-11  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/beos/ui_video.cc, ui_video.h: Added controls for
	the PAL settings.

2002-04-09  John Selck  <graham@cruise.de>

	* arch/win32/vsyncarch.c: vsyncarch_verticalblank() now
	synchronizes without changing the process priority of vice.
	Introduced vsyncarch_prepare_vbl() to avoid problems with
	the time-buffers when vertical blank sync is switched on.

	* vsyncapi.h: Added prototype for vsyncarch_prepare_vbl().

	* vsync.c: vsync_do_vsync() now only calls
	vsyncarch_verticalblank() when vice is running at 100%
	timer speed, no warp mode and ofcourse a usable video refresh
	rate. When no vbl-sync is done, vsyncarch_prepare_vbl() is
	called to keep the timer values up-to-date for vbl-sync.

2002-04-08  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.36.

	* arch/unix/console.c: Only use `rl_readline_name' if
	`HAVE_RLNAME' is defined.

	* c128/z80.c (opcode_ed): No need to inline this function.

2002-04-08  John Selck  <graham@cruise.de>

	* arch/win32/res.h: Added defines for new GUI elements.
	(IDC_VIDEO_ADVANCED_SHADE and
	IDC_VIDEO_ADVANCED_MODE)

	* arch/win32/res.rc: Added new GUI elements into the
	video/advanced dialog to configure PALMode and
	PALScanLineShade.

	* arch/win32/uivideo.c: init_advanced_dialog() now
	initializes the new GUI elements. dialog_advanced_proc()
	now handles them.

	* video/video-resources.c: set_pal_scanlineshade() now
	checks for value boundaries.
	Renamed "DelayLoopEmulation" into "PALEmulation".

	* arch/unix/uipalemu.c: Renamed "DelayLoopEmulation" into
	"PALEmulation".

	* arch/riscos/ui.c: Renamed "DelayLoopEmulation" into
	"PALEmulation".

	* arch/riscos/video.c: Renamed "DelayLoopEmulation" into
	"PALEmulation".

	* arch/os2/dialogs/menubar.c: Renamed "DelayLoopEmulation"
	into "PALEmulation".

	* arch/win32/c64ui.c: Renamed "DelayLoopEmulation" into
	"PALEmulation".

	* arch/win32/plus4ui.c: Renamed "DelayLoopEmulation" into
	"PALEmulation".

	* arch/win32/vic20ui.c: Renamed "DelayLoopEmulation" into
	"PALEmulation".

	* arch/beos/c128ui.cc: Renamed "DelayLoopEmulation" into
	"PALEmulation".

	* arch/beos/c64ui.cc: Renamed "DelayLoopEmulation" into
	"PALEmulation".

	* arch/beos/vic20ui.cc: Renamed "DelayLoopEmulation" into
	"PALEmulation".

	* vsync.c: vsync_do_vsync() now only allows sync to vertical
	blank on 100% speed.

2002-04-07  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.35.

	* vicii/vicii.c (vic_ii_update_video_mode): Removed
	optimization because it can cause the usage of wrong colors.

2002-04-06  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.34.

	* vicii/vicii-mem.c (vic_ii_local_store_vbank): Save store.

	* vicii/vicii.c (handle_check_sprite_dma): Execute saved vbank
	store if DMA is pending.
	(vic_ii_reset): Initialize `store_clk'.

	* vicii/viciitypes.h: Added `store_clk', `store_addr' and
	`store_value' to `struct vic_ii_s'.

2002-04-04  John Selck  <graham@cruise.de>

	* video/video-resources.c: Changed default value of
	PALScanLineShade from 500 to 667.

	* arch/win32/video.c: Added video_refresh_rate().
	video_create_canvas() now calculates the refresh rate
	of the current screenmode.

	* arch/win32/videoarch.h: Added prototype for
	video_refresh_rate() and changed video_canvas_s
	definition to contain a refresh rate.

	* arch/win32/fullscreen.c: SwitchToFullscreenMode()
	now buffers the non-fullscreen refresh rate and
	calculates a new one for the fullscreen screenmode.
	SwitchToWindowedMode() now restores the previous
	refresh rate.
	dialog_fullscreen_proc() forces recalculation of the
	refresh rate every time the fullscreen settings have been
	changed.

	* arch/win32/vsyncarch.c: Changed vsyncarch_verticalblank()
	to calculate the timer values out of a given refresh rate.

	* vsyncapi.h: Changed prototype of
	vsyncarch_verticalblank() to accept an additional
	refresh rate parameter.

	* vsync.c: vsync_do_vsync() now tests if the currently
	displayed refresh rate is near a multiple of the emulated
	machine refresh rate, and calls vsyncarch_verticalblank() if so.

2002-04-04  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* arch/riscos/vsync.c: adapted vsync_do_vsync signature

2002-04-03  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.33.

	* vicii/vicii-mem.c (check_bad_line_state_change_for_d011):
	Steal cycles before `num_chars' is changed.

	* arch/unix/plus4ui.c: Added RAM settings.

	* vsync.h: Added declaration of `video_canvas_s'.

2002-04-03  John Selck  <graham@cruise.de>

	* arch/win32/ui.c: Removed reset-requester from
	handle_wm_message().

	* arch/win32/vsyncarch.c: Added vsyncarch_verticalblank().

	* vsyncapi.h: Added prototype of vsyncarch_verticalblank().

	* vsync.c: Changed vsync_do_vsync() to accept a canvas.

	* vsync.h: Changed vsync_do_vsync() prototype to
	need a canvas now.

	* vicii/vicii.c: vic_ii_raster_draw_alarm_handler() now hands
	the current canvas to vsync_do_vsync().

	* vic20/vic.c: vic_raster_draw_alarm_handler() now hands
	the current canvas to vsync_do_vsync().

	* crtc/crtc.c: crtc_raster_draw_alarm_handler() now hands
	the current canvas to vsync_do_vsync().

	* plus4/ted.c: ted_raster_draw_alarm_handler() now hands
	the current canvas to vsync_do_vsync().

2002-04-02  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* arch/riscos/ui.c, arch/riscos/uiconfig.{c,h},
	arch/riscos/uihelp.c, arch/riscos/video.c: added different
	full screen mode descriptors for normal, PAL emu and double
	size PAL emu modes.

2002-04-02  Tibor Biczo  <crown@axelero.hu>

	* arch/win32/Makefile.am : New files added (uiplus4mem.c,
	uiplus4mem.h)

	* arch/win32/arch.dsp: New file added to poject
	(uiplus4mem.c).

	* arch/win32/plus4ui.c: Handle Plus4 settings menu.

	* arch/win32/res.h: Added menu and dialog entries for Plus4
	memory size selection dialog.

	* arch/win32/resplus4.rc: Added menu and dialog entries for
	Plus4 memory selection dialog.

	* arch/win32/uiplus4mem.c: New file, Plus4 memory size
	selection dialog.

	* arch/win32/uiplus4mem.h: New file.

	* plus4/plus4-cmdline-options.c: Added -ramsize.

	* plus4/plus4-resources.c: Added RamSize resource handling.

	* plus4/plus4mem.c: Added support routines for handling
	different memory sizes.
	(mem_initialize_memory): Initializes tables based on RamSize
	resource.

	* plus4/plus4memlimit.c: Added bank for $0000-$4000 area, and
	updated limit values.

	* plus4/ted-mem.c (ted_local_store_vbank_32k,
	ted_local_store_vbank_16k, ted_mem_vbank_store_32k,
	ted_mem_vbank_store_16k): New functions.

	* plus4/ted-mem.h (ted_mem_vbank_store_32k,
	ted_mem_vbank_store_16k): New function prototypes.

2002-04-02  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.32.

	* interrupt.h (interrupt_steal_cycles): Add all cycles to
	interrupt clocks.

	* vicii/vicii-mem.c (check_bad_line_state_change_for_d011):
	Use `maincpu_steal_cycles()' for stealing cycles.

	* diskimage.c (disk_image_check_for_d64): Use `size_t'.

	* drive/driverom.c (drive_new_rom_image_loaded): Changed to
	use `unsigned int'.

	* gfxoutputdrv/bmpdrv.c (bmpdrv_write): Likewise.

	* monitor/mon.c, monitor/mon_disassemble.c, monitor/mon_ui.c,
	monitor/mon_util.c: Added some casts.

2002-04-01  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.31.

	* vicii/vicii-mem.c (vic_ii_local_store_vbank): Fixed write
	access before DMA.

	* arch/unix/x11/xaw/uivsidcontrol.c (build_vsid_ctrl_widget):
	Control reached end of non-void function.

2002-03-31  Dag Lem  <resid@nimrod.no>

	* sid/fastsid.c: Moved filter variables into sound_s struct to
	keep the filters for stereo SIDs separate.

2002-03-29  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.30.

	* vicii/vicii-mem.c (store_d019, read_d019): Fixed.
	(store_d011, store_d012): Fixed irq state check.
	(check_irq_line_state): New function.

	* petcat.c, 6510core.c, log.c: Cosmetics.

2002-03-28  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.29.

	* drive/drive-resources.c: True drive emulation is default.

	* autostart.c (autostart_reset): Call `disk_eof_callback'.

	* printerdrv/driver-select.c, printerdrv/drv-ascii.c: Added
	some debugging outout.

2002-03-28  Andreas Matthies  <andreas.matthies@gmx.net>

	* fliplist.c (flip_load_list): Don't call fopen if filename
	is NULL.

	* arch/win32/ui.c: Call suspend_speed_eval _before_ displaying
	the "Do you want to reset?" box.

2002-03-25  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* arch/riscos/ui.c, arch/riscos/uiconfig.{c,h},
	arch/riscos/uihelp.c: removed icon for DelayLoopEmulation,
	resource modified implicitly now

	* arch/riscos/uidummy.c: removed machine_name stubs (now in
	c1541.c and petcat.c)

	* arch/riscos/video.c: handle raw RGB colours, automatically
	enable DelayLoopEmulation when PAL emulation is activated.
	Fixed canvas_force_redraw()

2002-03-24  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/xaw/uicolor.c (uicolor_alloc_system_colors):
	Pass NULL canvas to color_alloc_colors.
	(uicolor_convert_color_table): Don't call
	video_convert_color_table if canvas == NULL.

2002-03-23  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.28.

	* vicii/vicii-mem.c (store_d019): Added fix as suggested by
	AndreasM.

2002-03-23  pottendo  <pottendo@utanet.at>

	* petcat.c: Added dummy `machine_name'.
	* c1541.c: Likewise.

	* arch/unix/uicommands.c (load_save_fliplist): New
	function. Implementation for fliplist load/save ui.
	(flip_submenu): Added load-save menu entries.

	* arch/beos/archdep.c (archdep_default_fliplist_file_name): New
	dummy function. Please fill in appropriate default fliplist file name.
	* arch/win32/archdep.c (archdep_default_fliplist_file_name): Likewise.
	* arch/os2/archdep.c (archdep_default_fliplist_file_name): Likewise.
	* arch/msdos/archdep.c (archdep_default_fliplist_file_name): Likewise.
	* arch/riscos/archdep.c (archdep_default_fliplist_file_name): Likewise.
	* arch/unix/uisettings.c (save_resources callback): Save flip lists.

	* main.c (MAIN_PROGRAM): Load default fliplist on startup.

	* fliplist.c (flip_save_list): Added unit support to fliplist
	file. 
	(flip_load_list): Likewise. 

2002-03-22  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/msdos/c128ui.c, c610ui.c, c64ui.c, petui.c, plus4ui.c,
	vic20ui.c: Changed behaviour of the color related menus to
	TUI_MENU_BEH_RESUME. This will prevent color mixups.
	Renamed "fast PAL" to "PAL" and added meuitem for external
	colors.

	* arch/msdos/video.c (canvas_change_palette): Added raw rgb
	support for video_render.

2002-03-20  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/dga2.c (fullscreen_set_palette): Made
	palette_t parameter const.

	* arch/unix/x11/gnome/uicolor.c (uicolor_alloc_system_colors):
	Pass NULL canvas to color_alloc_colors.
	(uicolor_convert_color_table): Don't call
	video_convert_color_table if canvas == NULL.

	* arch/unix/x11/renderxv.c (render_yuv_image): Initialize
	variables which gcc (incorrectly) warns about.

	* arch/unix/x11/video.c (video_convert_color_table): Use bits
	per pixel instead of color depth for rendering.
	(convert_8to8n): Likewise.
	(video_convert_func): Likewise.

	* arch/unix/x11/videoarch.h (fullscreen_set_palette): Made
	palette_t parameter const.
	(fullscreen_resize): Added missing prototype.

	* monitor/mon.c (mon_record_commands): Corrected printf
	format.

2002-03-18  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* arch/riscos/ui.c: moved canvas window resizing to video.c,
	minor cleanup

	* arch/riscos/videoarch.h, arch/riscos/video.c: moved canvas
	resizing to video.c, finished PAL emulation (double size OK).

2002-03-18  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.27.

2002-03-14  pottendo  <pottendo@utanet.at>

	* arch/unix/x11/video.c (video_canvas_create): Just initialize
	colors for real PAL emulation when depth is > 8.

2002-03-12  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/video.c: Made -mitshm and +mitshm work
	according to manual.
	(video_convert_color_table): Special handling for 15 bit
	color.
	(convert_8to8n): Replaces convert_8to8, convert_8to16, and
	convert_8to32. Also passes 15 and 24 bit color to new render
	engine.
	(convert_8to8, convert_8to16, convert_8to32): Removed.
	(video_convert_func): Pass 15 and 24 bit color to new render
	engine.

2002-03-11  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* arch/riscos/ui.c: moved palette file to video config window

	* arch/riscos/uiconfig.{c,h}: moved palette file to video
	config window, corrected widget type of PAL delay loop
	emulation

	* arch/riscos/uihelp.{c,h}: improved encapsulation

	* arch/riscos/video.c: fixed PAL sprite translation table bug
	(writes to uninitialized memory), additional safeguards,
	support 8bpp PAL emu modes, corrected screen to canvas
	coordinate transformation (scaling)

2002-03-10  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.26.

	* vicii/vicii-mem.c (check_bad_line_state_change_for_d011):
	Do not reset bad line state after a bad line has happened,
	this is only possible before matrix fetch.

2002-03-10  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/gnome/ui.c (ui_open_canvas_window): Refresh
	canvas when application window is moved - required for XVideo.

	* arch/unix/x11/xaw/ui.c (ui_open_canvas_window): Likewise.

2002-03-08  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/gnome/gnomevideo.c (frame_buffer_alloc): Don't
	double size of target image.

	* arch/unix/x11/xaw/x11video.c (frame_buffer_alloc): Likewise.

	* arch/unix/x11/video.c (convert_*): Use correct target image
	positions.
	(video_canvas_refresh): Removed XVideo clipping. Pass correct
	image positions to _convert_func and _refresh_func.

	* arch/unix/x11/xaw/ui.c: Removed old exposure cruft.

2002-03-07  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* arch/riscos/uihelp.{c,h}: new files for interactive help

	* arch/riscos/uisharedef.h: new file for shared ui-specific
	defs

	* arch/riscos/uiconfig.{c,h}: added resources for video layer,
	mangled config icon window names into config icon names

	* arch/riscos/ui.{c,h}: adapted to changed config icon names,
	exported interactive help to uihelp.{c,h}, shared defs to
	uisharedef.h, grey-out icon lists and icon bar icon names
	to machine-specific ui stubs and window->canvas coordinate
	translation to video.c

	* arch/riscos/video.c, arch/riscos/videoarch.h: do window to
	canvas coordinate translation here now

	* arch/riscos/c128ui.c, arch/riscos/c610ui.c,
	arch/riscos/c64ui.c, arch/riscos/petui.c,
	arch/riscos/plus4ui.c, arch/riscos/vic20ui.c:
	handle grey-out icon lists and icon bar icon names

	* arch/riscos/Makefile.am: added uihelp.{c,h} and uisharedef.h

2002-03-06  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.25.

	* raster/raster-line.c (check_for_major_changes_and_update,
	handle_visible_line_without_cache): Use xsmooth color for
	overscan color if borders are open in non-idle modes.

2002-03-06  Andreas Matthies  <andreas.matthies@gmx.net>

	* vic20/vic20.c (vic_store): Cast to signed int in
	calculation of vic.row_offset

2002-03-03  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* arch/riscos/ui.c: updated help text, determine framebuffer
	coords for redraw.

	* arch/riscos/uiconfig.{c,h}: added resources for stereo SID
	address emu.

	* arch/riscos/video.c, arch/riscos/videoarch.h: added 1x PAL
	emulation rendering.

2002-03-02  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.24.

	* drive/drive.c (drive_sync_found): Do not report sync if disk
	is changing.

2002-03-01  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/beos/constants.h: New id for DirectWindow toggle.

	* arch/beos/ui.cc, ui.h: New function ui_set_window_mode.
	New menu toggle for DirectWindow.

	* arch/beos/vicemenu.cc: Renamed 'Fast PAL' to 'PAL'. Added
	menuitem for DirectWIndow toggle.

	* arch/beos/vicewindow.cc: Reenabled the bitmap stuff. It is
	used if DirectWindow is disabled. Fixed menubar_offset and
	position of the view and the statusbar.

	* arch/beos/video.cc: Reenabled the bitmap stuff (for disabled
	DirectWindow). New resource 'DirectWindow' and commandline
	options +- directwindow.

	* arch/beos/videoarch.h: Include video.h.

	* raster/raster.c (raster_update_canvas_all): Fixed xs in the
	call of video_canvas_refresh.

2002-02-27  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/renderxv.c: Added credits, fixed typos.

	* arch/unix/x11/video.c: XVIDEO and FOURCC resources only
	available when HAVE_XVIDEO is defined.

	* resources.c: Added missing breaks in switch statements.

2002-02-27  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.23.

	* vicii/viciitypes.h: New define `VIC_II_IS_TEXT_MODE'.

	* vicii/vicii-draw.c (_draw_idle): Improved background color
	and idle data handling.

	* debug.c, debug.h (debug_init_cmdline_options): New function.

	* init.c (init_cmdline_options): Initialize debug command line
	options.

2002-02-26  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.22.

	* maincpu.h: Removed some cruft.

2002-02-25  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* resources.{c,h}: each resource now allows an arbitrary
	number of callback functions. Global resource callbacks are
	called with resource name if only this resource changed.

	* arch/riscos/videoarch.h, arch/riscos/video.c: added support
	for 1x2 plotters (x128); implemented core redraw code as
	function pointers.

2002-02-25  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/win32/base.dsp: Added new source files.

	* raster/raster-cache.c (raster_cache_init): Clear gfx_msk.

	* vicii/vicii-sprites.c: Removed all the raster double size
	related stuff.
	(draw_hires_sprite): collmsk needs to be shifted if size is
	changed by repeated pixels.
	(draw_mc_sprite): Fixed calculation of repeat_offset.
	The hack for the repeated pixels may cause a sprite collision
	with its own. If so delete it.

2002-02-24  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/gnome/gnomevideo.c
	(video_arch_frame_buffer_alloc): Corrected FOURCC sprintf
	format typo.

	* arch/unix/x11/xaw/x11video.c
	(video_arch_frame_buffer_alloc): Likewise. Made fullscreen
	compile by replacing fullscreen_set_framebuffer with
	fullscreen_set_canvas.

	* arch/unix/x11/xaw/ui.c (ui_open_canvas_window): Set video
	canvas as client data for exposure handler.
	(exposure_callback): Call raster_force_repaint.

2002-02-24  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.21.

	* drive/drive.h: Relaxed disk changing times.

	* debug.c, debug.h, init.c, init.h, initcmdline.c,
	initcmdline.h: New files.

	* Makefile.am: Added new files.

	* main.c: Moved machine and resource initialization and inital
	command line parsing to other files.

	* maincpu.c, maincpu.h, 6510core.c, drive/drivecpu.c, main.c,
	arch/unix/uisettings.c, arch/unix/uisettings.h,
	arch/unix/c64ui.c, arch/unix/c128ui.c, arch/unix/vic20ui.c,
	arch/unix/petui.c, arch/unix/plus4ui.c, arch/unix/c610ui.c:
	Added support for enabling CPU trace from within the GUI.

	* vicii/vicii-mem.c (store_d01d): Added fix as suggested by
	AndreasM.

2002-02-23  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.20.

	* vicii/viciitypes.h: New member `hires_background_color'.

	* vicii/vicii.c (vic_ii_fetch_matrix): Set hires background
	color source.  (vic_ii_update_video_mode): Handle hires
	background color source.

	* vicii/vicii-draw.c (draw_std_background): Use `xsmooth' to
	draw the background.

	* raster/raster-line.c: Check xsmooth.

2002-02-23  pottendo  <pottendo@utanet.at>

	* arch/unix/x11/gnome/ui.c (ui_open_canvas_window): Pass canvas to
	exposure callback. 
	(exposure_callback): Force repaint.

2002-02-22  Spiro Trikaliotis  <Spiro.Trikaliotis@gmx.de>

	* arch/win32/uimon.c: closing the monitor with the close
	button does not result in strange behaviour anymore

	* arch/win32/raster.dsp: added raster-line.c

	* raster/raster-line.c: now #includes video.h so that it
	compiles

2002-02-20  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* resources.{c,h}: added hash index over resource names for
	improved speed; added resources_register_callback() function
	for registering a callback function if a specific resource (or
	any resource) is modified.

	* arch/riscos/ui.c: added help text for stereo SID and BPlot
	icons. register video layer resource callbacks.

	* arch/riscos/videoarch.h, arch/riscos/video.c: register
	resource callbacks for resources changing canvas properties.

	* sounddrv/soundacorn.c: added DRender include due to lib change.

2002-02-20  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/win32/raster.dsp: Added raster-line.c

	* arch/win32/videoarch.h: Include video.h

	* vic20/vic-mem.c (vic_store): Don't set blank_this_line if
	number of columns is 0.

2002-02-18  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* arch/riscos/video.c, arch/riscos/videoarch.h: completed
	migration to new interface.

	* arch/riscos/ui.c: updated Plus4 and Stereo SID icons, grey
	out icons belonging to unknown resources.

	* arch/riscos/uiconfig.{c,h}: added icons for Stereo SID and
	optional BPlot module.

2002-02-17  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.19.

	* vicii/vicii-draw.c (draw_std_background): The background
	color in the xsmooth region is set by xsmooth color.

	* raster/raster-line.c, raster/raster-line.h, raster/raster.h,
	crtc/crtc.c (raster_handle_end_of_frame): Renamed.

2002-02-17  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/renderxv.c: Added scanline shading. Completed
	implementation of double size rendering.
	(find_yuv_port): Allow request for specific video format.

	* arch/unix/x11/renderxv.h: Added scanline shading.

	* arch/unix/x11/video.c: Added FOURCC resource and -fourcc
	parameter.
	(video_canvas_refresh): Added scanline shading for XVideo.

	* c64/psiddrv.a65: Changed BRK interrupt vector to IRQ exit.

	* raster/raster.c (raster_init): Removed special handling of
	HAVE_XVIDEO.

	* video/render1x1.c, video/render2x2.c, video/render2x2pal.c:
	Removed ^M.

2002-02-17  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.18.

	* vicii/vicii-draw.c, vicii/vicii-mem.c, vicii/vicii.c,
	raster/raster.c, raster/raster.h, raster/raster-cache.h,
	vdc/vdc.c, crtc/crtc.c, vic20/vic.c, plus4/ted.c,
	plus4/ted-mem.c: Added new member `xsmooth_color' to raster
	API.
	Replaced some hacks and kludges by using `xsmooth_color'.

	* raster/raster-line.c, raster/raster-line.h: New files.

	* raster/Makefile.am: Added new files.

2002-02-16  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.17.

2002-02-15  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/win32/uisound.c: Removed setting of stereo sid
	resource.

2002-02-14  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/beos/vicewindow.cc, vicewindow.h: Added includes for
	DirectWindow. Disabled every code related to the old bitmap
	drawing code (may be reenabled as a fallback if DirectWindow
	isn't supported). ViceWindow now derives from DirectWindow.
	New method ViceWindow::DirectConnected. New varaible for
	menubar_offset.

	* arch/beos/video.cc: Disabled bitmap related code.
	(video_canvas_refresh) uses the clip_rect list of the
	DirectWindow to get the partitions for rendering.

	* raster/raster.c: Renamed update_canvas_all to
	raster_update_canvas_all and made it public.
	(raster_get_raster_from_canvas): New function.

	* raster/raster.h: Added prototypes for new functions.

	* video/Makefile.am: Added src/raster to paths for includes.

	* video/video-render.c: Include raster.h
	(video_refresh_all): New function.

2002-02-14  Thomas Bretz  <tbretz@physik.tu-muenchen.de>

	* arch/os2/dialogs/dlg-drive.c:
	- added 1551
     
	* arch/os2/dialogs/dlg-fileio.c:
	- disabled autostart button in save-as dialog
	- fixed the storage of the last successfull path
     
	* arch/os2/vac++/incl/drive.icc:
	- added glue1551.c, tia1551.c
     
	* arch/os2/vac++/incl/plus4.icc:
	- added tcbm.c
     
	* zipcode.c:
	- simplified code structure in a loop
     
2002-02-13  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/gnome/gnomevideo.c (GDK_PUTIMAGE): Draw
	directly into window instead of to pixmap.
	(video_arch_frame_buffer_alloc): Call new find_yuv_port
	interface.
	(ui_finish_canvas): Removed use of backing store pixmap.

	* arch/unix/x11/renderxv.c: Generalized API, started work on
	2x renderers.

	* arch/unix/x11/renderxv.h: Generalized API.

	* arch/unix/x11/video.c (video_canvas_refresh): Prepare for 2x
	Xv renderers.

	* arch/unix/x11/videoarch.h: Modified video_canvas_t for new Xv
	API.

	* arch/unix/x11/xaw/x11video.c
	(video_arch_frame_buffer_alloc): Call new find_yuv_port
	interface.

2002-02-13  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.16.

	* vicii/vicii-draw.c (_draw_idle): Overscan color is black if
	hires mode is enabled (fix as suggested by AndreasM).
	(draw_idle_std_background): New function.
	(setup_single_size_modes): Set `draw_idle_std_background()' as
	idle state background draw function.

2002-02-12  Spiro Trikaliotis  <Spiro.Trikaliotis@gmx.de>

	* c64/reu.c: added the "Half-autoload-bug" (reported by
	Wolfgang Moser) so that the FIXMEs could be removed; disabled
	REU_DEBUG again, added symbolic names for the REU registers
	for better readability.

2002-02-11  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.15.

	* c64/c64mem.c (ram_hi_store): Only propagate stores to the
	vbank if vbank 3 is active.

	* vicii/vicii-mem.c (check_bad_line_state_change_for_d011): If
	a forced DMA switches to display state override the blank flag
	in case the store that causes the DMA sets the blank bit
	again.

	* vicii/vicii.c (vic_ii_raster_draw_alarm_handler): Clear the
	blank override flag at line zero.

	* raster/raster.c (raster_emulate_line): Switch off blanking
	at `display_ystart' if the blank override flag is set too.
	(raster_reset): Initialize `blank_off' bit.

	* raster/raster.h: Added new member `blank_off' to
	`struct raster_t'

	* plus4/tcbm.c, plus4/tcbm.h: TCBM implementation.

	* iecdrive.h, c64/c64iec.c, c128/c128iec.c, vic20/vic20iec.c,
	pet/petiec.c, cbm2/c610iec.c: Added some stubs.

	* drive/tia1551.c, drive/tia1551.h: Interface to TCBM bus.

	* arch/unix/readline/editline.c,
	arch/unix/readline/editline2.c: Removed `^L'.

2002-02-10  Tibor Biczo  <crown@axelero.hu> 

	* plus4/plus4mem.c (mem_proc_port_read): Mask in IEC inputs
	correctly. 
      
2002-02-10  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.14.

	* vicii/vicii-mem.c (check_bad_line_state_change_for_d011,
	store_d011): Fixed the calculation of `was_bad_line'.

	* c64/c64mem.c (ram_hi_store): Handle vbank access.

	* zipcode.c (zipcode_read_sector): Use `unsigned char' for
	parameters read from disk as we need to count up to 255.

	* zfile.c (try_uncompress_zipcode): Handle directories.

2002-02-09  pottendo  <pottendo@utanet.at>

	* arch/unix/x11/dga2.c (fullscreen_set_mode): Setup up `fs_depth'.
	(fullscreen_refresh_func): Use `fs_depth'.
	(fullscreen_vidmode_available): Gather modes with 16bit or better
	depth. This makes full PAL emulation work under DGA2.

	* arch/unix/x11/videoarch.h: Adjusted prototypes for new alloc
	callback interface.

	* arch/unix/x11/dga2.c (fs_draw_buffer_alloc): Adjusted to new
	alloc callback interface.
	(fs_draw_buffer_free): Likewise.
	(fs_draw_buffer_free): Likewise.

2002-02-09  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.13.

	* video/render2x2pal.c: `line_yuv_0' and `line_yuv_1' are
	externals.

2002-02-09  Thomas Bretz  <tbretz@physik.tu-muenchen.de>

	* arch/os2/video.c:
	make use of ne machine_canvas_async_refresh

	* machine.h, c128/c128.c, c64/c64.c, cbm2/c610.c,
	plus4/plus4.c, vic20/vic20.c
	- implementation of machine_canvas_async_refresh
	- changed calls to *_screenshot to void

	* crtc/crtc.[h,c], pet/pet.[h,c], plus4/ted.[c,h],
	vdc/vdc.[h,c], vic20/vic.[h,c], vicii/vicii.[h,c]:
	- new implementation of *_async_refresh

	* raster/raster.[h,c]:
	- new implementation of raster_async_refresh

	* screenshot.h:
	- removed bufh from screenshot_t

	* video.h:
	- new implementation of struct canvas_refresh_s

2002-02-09  Andreas Matthies  <andreas.matthies@gmx.net>

	* plus4/plus4pio1.c: Added variable for tape sense.
	(pio1_store) takes care of the actual tape sense.
	(pio1_set_tape_sense) stores sense in the new variable.

2002-02-08  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/video.c (video_canvas_refresh): Catch all
	raster offscreen errors.

2002-02-07  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* video.h: changed signature of video_draw_buffer_callback
	functions

	* raster/raster.h: added frame buffer pitch

	* raster/raster.c: adapted to changed
	video_draw_buffer_callback signature

	* arch/riscos/ui.c: exported plot code to video.c

	* arch/riscos/videoarch.h, arch/riscos/video.c: migrated to
	new video_draw_buffer_callback signature, next step in move to
	new video render interface.

2002-02-07  Tibor Biczo  <crown@axelero.hu>

	* plus4/plus4pio1.c (pio1_store): Bit 2 is only input, don't
	store written value.

	* plus4/ted-timer.c (ted_t1, ted_t2, ted_t3): Update current
	value on overflow.

2002-02-07  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/renderxv.c: Added YUV 4:1:1 rendering for Y/C
	and Composite emulation.

	* arch/unix/x11/video.c (video_canvas_refresh): Catch more
	raster offscreen errors.

2002-02-07  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/beos/videoarch.h: Removed video_draw_buffer_callback.

	* arch/win32/drive.dsp, plus4.dsp: Added new files.

	* vdc/vdc.c (vdc_update_geometry): vdc.last_displayed_line
	bounded with screen_height. This fixes NTSC crash in x128.

2002-02-07  Thomas Bretz  <tbretz@physik.tu-muenchen.de>

	* arch/os2/dialogs/menubar.[h,c,rc], src/arch/os2/kbd/proc.c:
	- included accelerator keys Alt-2 and Alt-v

	* arch/os2/vac++/incl/plus4.icc:
	- corrected

	* arch/os2/video.c:
	- corrected some wrong output

	* raster/raster.c:
	- simplified some algorithm

	* vdc/vdc.c:
	- changed in a way that it (setup, init, changes, etc) 
	behaves like the other chips

2002-02-06  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.12.

	* fullscreen.h: #include "types.h".

	* drive/driverom.c, drive/driverom.h, drive/tia1551.c,
	drive/tia1551.h, drive/glue1551.c, drive/glue1551.h,
	plus4/tcbm.c, plus4/tcbm.h: New files.

	* drive/Makefile.am, plus4/Makefile.am: Added new files.

	* drive/drive.c, drive/drive-resources.c, drive/drivemem.c,
	drive/drive-snapshot.c: Changed to new image rom reorg.

	* drive/drivemem.c (drive_mem_init, drive_ioreg_list_get):
	Added 1551 support.
	(drive_read_zero): New function.

	* drive/drivecpu.c (drive_cpu_snapshot_write_module,
	drive_cpu_snapshot_read_module, drive_jam, cpu_reset,
	drive_cpu_early_init): Likewise.
	(drive_read_zero, drive_read_1551zero, drive_store_zero,
	drive_store_1551zero): New functions.

	* drive/drive.c, drive/drive.h (drive_set_active_led_color,
	drive_read_image_d64_d71, ve_set_clock_frequency,
	drive_check_image_format, drive_set_half_track,
	drive_check_type): Likewise.
	(drive_sync_found, drive_write_protect_sense): Made external.

2002-02-06  John Selck  <graham@cruise.de>

	* video/render1x1pal.c: Removed extern gammatable[].
	Removed code from all 1x1 pal renderers which was
	supposed to be for 2x2 pal only.

	* video/render2x2pal.c: Removed extern gammatable[].

	* video/video-color.c: Removed obsolete extern definitions.

	* raster/raster.c: Changed all RASTER_PIXEL() calls into
	direct usage of the color.

	* crtc/crtc-draw.c: Changed all RASTER_PIXEL() calls into
	direct usage of the color.

	* vdc/vdc-draw.c: Changed all RASTER_PIXEL() calls into
	direct usage of the color.

	* vic20/vic-draw.c: Changed all RASTER_PIXEL() calls into
	direct usage of the color. There are still RASTER_PIXEL()
	calls used in vic.h.

2002-02-06  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/gnome/gnomevideo.c
	(video_arch_frame_buffer_alloc): Display YUV FOURCC.

	* arch/unix/x11/renderxv.c: Added YUV 4:2:2 rendering for Y/C
	and Composite emulation.

	* arch/unix/x11/renderxv.h: Added pal_mode parameter to
	interface.

	* arch/unix/x11/video.c (video_canvas_refresh): Pass pal_mode
	to Xv interface.

	* arch/unix/x11/videoarch.h: Added xv_render to
	video_canvas_s.

	* arch/unix/x11/xaw/x11video.c
	(video_arch_frame_buffer_alloc): Display YUV FOURCC.

2002-02-04  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* arch/riscos/videoarch.h, arch/riscos/video.c,
	arch/riscos/ui.c: started migration to new video interface.

	* raster/raster.c: recalculation of frame buffer no longer
	needed.

2002-02-04  pottendo  <pottendo@utanet.at>

	* raster/raster.c (raster_draw_buffer_free): Return in case a
	callback has been called.
	(raster_draw_buffer_clear): Likewise.
	(realize_frame_buffer): Call `video_register_raster()' to setup
	hooks for DGA2.

	* fullscreen.h: Fixed for DGA2.

	* arch/unix/x11/video.c (video_canvas_create): Use allocation
	callback hooks to allocate draw_buffer in case of DGA2
	availability. 
	Fixed for DGA2.
	(video_canvas_refresh): Fixed for DGA2.

	* arch/unix/x11/gnome/gnomevideo.c
	(video_arch_frame_buffer_alloc): Fixed for DGA2.

	* arch/unix/uivicii.c: Moved PAL Emulation menu definition in
	separate files.

	* arch/unix/uisettings.c: Added `types.h'.

	* arch/unix/uipalemu.c: New file. Setup PAL emulation menu
	entries. 
	* arch/unix/uipalemu.h: Define PAL Emulation menu.

	* arch/unix/plus4ui.c: Added PAL Emulation submenu.
	* arch/unix/vic20ui.c: Likewise.

	* arch/unix/Makefile.am (libarch_a_SOURCES): Added
	`uipalemu.[ch]'. 

2002-02-02  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.11.

2002-02-01  Andreas Matthies  <andreas.matthies@gmx.net>

	* sounddrv/soundwmm.c (wmm_suspend): Write n fragments instead
	of whole buffer at once.

2002-02-01  John Selck  <graham@cruise.de>

	* vicii/vicii-draw.c: Changed all RASTER_PIXEL() calls into
	direct usage of the color.
	Optimized _draw_mc_text(), _draw_mc_bitmap(),
	draw_ext_text_foreground() a bit.

	* vicii/vicii-sprites.c: Changed all RASTER_PIXEL() calls
	into direct usage of the color.
	Changed macros to not need raster pointer anymore.

	* plus4/ted-draw.c: Changed all RASTER_PIXEL() calls into
	direct usage of the color.
	Optimized _draw_mc_text(), _draw_mc_bitmap(),
	draw_ext_text_foreground() a bit.

2002-02-01  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/beos/videoarch.h: Added video_draw_buffer_callback to
	video_canvas_s.

	* arch/beos/video.cc (video_canvas_set_palette): Calls
	video_render_setrawrgb for real PAL emulation.

2002-02-01  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.10.

	* vdc/vdc.c (vdc_raster_draw_alarm_handler, vdc_set_geometry):
	Use video API to scale for double heigth mode.

	* vdc/vdc-draw.c: Removed odd/even line support.

	* video/video-render.c: Removed unused variables.

2002-02-01  Thomas Bretz  <tbretz@physik.tu-muenchen.de>

	* arch/os2/config.h:
	- fixed a bug in defining HAVE_MOUSE
    
	* arch/os2/video.c:
	- added an automatic depth detection
	- added some more color formats
	- added some debug output in case of a failing of
	DiveSetupBlitter or DiveBlit
	- added some more security checks in canvas_refresh
    
	* raster/raster.c:
	- simplified many parts of the code exspecially
	raster_emulate_line, and raster_resize_viewport (I'm sorry,
	this part cannot be tested by me, please check whether
	everything works fine)
	- removed the 1x1 draw_buffer allocation. For what is a
	workaround necessary if you could do it more straight forward?
      
2002-01-31  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.9.

	* raster/raster.c (raster_free): Check if canvas is allocated.
	(raster_init): Initialize draw buffer pointer.

2002-01-31  Tibor Biczo  <crown@axelero.hu>

	* arch/win32/plus4ui.c: Added PAL emulation switch to UI.

	* arch/win32/resplus4.rc: Added PAL emulation switch to UI.

	* arch/win32/video.c (video_canvas_create): Fixed typo.

	* datasette.c (datasette_read_gap): Implemented version 1 and
	version 2 TAP reading for Plus4.
	(datasette_set_tape_image, datasette_internal_reset): Reset
	fullwave flag.
	(datasette_start_motor): Don't change fullwave flag.

	* plus4/plus4.h: Updated cycles in line to 114, and cycles per
	sec values both for PAL and NTSC.

	* plus4/plus4mem.c (mem_proc_port_read): Fixed CST READ
	sygnal.

	* plus4/ted-timer.c: Updated timers to work correctly on
	double clock, and implemented read accesses.

	* plus4/tedtypes.h: Fixed NTSC screen height.

2002-01-31  Andreas Dehmel  <dehmel@forwiss.tu-muenchen.de>

	* raster/raster.c: Sun compiler doesn't allow returning void

2002-01-31  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/gnome/ui.c
	(ui_open_canvas_window): Change canvas background color to
	black.

	* arch/unix/x11/renderxv.c (render_4_2_2, render_4_1_1):
	Average U and V values in source pixel block.

	* arch/unix/x11/video.c: Added +xvideo command line parameter.

2002-01-30  pottendo  <pottendo@utanet.at>

	* uicolor.h (uicolor_init_video_colors): New prototype.

	* arch/unix/x11/video.c (video_canvas_create): Request
	initialization of colors.

	* arch/unix/x11/gnome/uicolor.c (uicolor_init_video_colors): New
	function, initialize the video layer with pixel values.
	* arch/unix/x11/xaw/uicolor.c (uicolor_init_video_colors):
	Likewise.

	* arch/unix/uivicii.c: Reworked PAL related menus and callbacks. 

2002-01-30  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.8.

	* vicii/vicii-mem.c (store_d019): Removed some leftovers.

	* vicii/vicii-draw.c (_draw_mc_text): Replaced remaining
	`PIXEL' type.

	* arch/unix/x11/videoarch.h, arch/win32/videoarch.h,
	arch/msdos/videoarch.h, arch/riscos/videoarch.h,
	arch/os2/videoarch.h, arch/beos/videoarch.h: Added draw buffer
	alloc/free/clear callback to the canvas struct.

	* arch/unix/x11/video.c, arch/win32/video.c,
	arch/msdos/video.c, arch/riscos/video.c, arch/os2/video.c,
	arch/beos/video.cc (video_canvas_creat): Initialize draw
	buffer callback.

	* raster/raster.c (raster_draw_buffer_alloc,
	raster_draw_buffer_free, raster_draw_buffer_clear): Added
	callbacks for arch specific draw buffer allocation.
	(raster_force_repaint): Do not clear draw buffer.
	(realize_frame_buffer): Do not realize frame buffer (should be
	called draw buffer now) if there is no canvas.

	* video.h: Added structure for draw buffer callbacks.

2002-01-30  Thomas Bretz  <tbretz@physik.tu-muenchen.de>

	* doc/vice.texi:
	- changed a bug in my email address
     
	* arch/os2/dialogs/menubar.[h,c,rc]:
	- implemented the new PAL Emulation modes
     
	* arch/os2/vac++/incl/video.icc:
	- added the new renderers
     
	* arch/os2/video.c:
	- implement usage of the new renderers (only R565 supported
	yet)
	- replaced most of the 'in code' #ifdefs by if statements
   
	* arch/os2/videoarch.h:
	- added bDepth to canvas_t
     
	* raster/raster.c:
	- made sure that video_canvas_refresh is never called with 
	heights which exceeds the viewport area
	- replaced a free/malloc combination by a realloc
	- small simplifications to the code
     
	* utils.c:
	- replaced to additions in stralloc by one

2002-01-29  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/gnome/gnomevideo.c
	(video_arch_frame_buffer_alloc): Call new find_yuv_port
	interface.

	* arch/unix/x11/renderxv.c: Added support for UYVY, YUY2,
	YVYU, and IYUV.

	* arch/unix/x11/renderxv.c: New find_yuv_port interface
	exporting the render function for the selected YUV format.

	* arch/unix/x11/video.c (video_canvas_refresh): Pick up
	another offscreen bug from the raster layer.

	* arch/unix/x11/videoarch.h: Added xv_render to
	video_canvas_s.

	* arch/unix/x11/gnome/gnomevideo.c
	(video_arch_frame_buffer_alloc): Call new find_yuv_port
	interface.

2002-01-29  Tibor Biczo  <crown@axelero.hu>

	* arch/win32/main_exit.c (main_exit): Removed putchar call.

	* sounddrv/sounddx.c, sounddrv/soundwmm.c (sound_suspend):
	Fixed a bug where the stack was overwritten if stereo sound
	was enabled.

2002-01-29  John Selck  <graham@cruise.de>

	* arch/win32/videoarch.h: Removed PIXEL *pixel_translate
	from video_canvas_t definition and changed PIXEL *pixels
	into BYTE *pixels.

	* arch/win32/video.c: set_physical_colors() no longer updates
	pixels and pixel_translate in video_canvas_t.
	video_canvas_create() no longer allocates pixel_translate[].

	* arch/win32/video.dsp: Added render1x1pal.c and
	render2x2pal.c to project.

2002-01-29  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/gnome/gnomevideo.c: Added X Video handling.

	* arch/unix/x11/gnome/ui.c (ui_create_status_bar): Glue fixed
	size status bar to bottom.
	(ui_open_canvas_window): Glue resizeable canvas to top.

	* arch/unix/x11/video.c (video_canvas_resize): Don't attempt
	to resize canvas for Xv.
	(video_canvas_refresh): GDK X typecasts for Window and GC
	passed to Xv.

2002-01-28  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.7.

	* vicii/vicii-mem.c (store_d019): Also remove pending raster
	alarms that would be schedulded before the end of the store.

	* plus4/ted-mem.c (ted09_store): Changed likewise.

	* video/Makefile.am: Added new files.
	
2002-01-27  John Selck  <graham@cruise.de>

	* arch/win32/resc64.rc: Renamed "Fast PAL" menu entry into
	"PAL Emulation".

	* arch/win32/resvic.rc: Renamed "Fast PAL" menu entry into
	"PAL Emulation".
 
	* video/video-color.c: Added global tables gamma_*[],
	gamma_*_fac[] and color_*[].
	Added video_render_setrawrgb() function.
	Added video_render_initraw() function.
	Added video_gamma() function.
	video_convert_ycbcr_to_rgb() now uses video_gamma()
	instead of it's own calculation routines.
	video_calc_gammatable() now fills the gamma_*[] and
	gamma_*_fac[] tables with the gamma corrected color
	channels.
 
	* video.h: Added prototypes for video_render_setrawrgb()
	and video_render_initraw().
 
	* arch/win32/video.c: set_physical_colors() now hands the
	RGB color channels to the video_render_setrawrgb() function.
 
	* video/render1x1pal.h: Added file.

	* video/render1x1pal.c: Added file.

	* video/render2x2pal.h: Added file.

	* video/render2x2pal.c: Added file.

	* video/video-render.c: Changed video_render_main() to call
	pal renderers.
 
	* video/video-resources.h: Removed pal_emulation variable and
	added pal_scanlineshade and pal_mode to video_resources_t
	definition.
	Added defines for different pal rendermodes.

	* video/video-resources.c: Removed initialisation routines for
	pal_emulation and added init routines for pal_scanlineshade
	and pal_mode.
	Added resource variables "PALScanLineShade" and "PALMode".
 
	* raster/raster.c: update_canvas() now enlarges the update area
	a bit more when pal emulation is activated.

2002-01-27  pottendo  <pottendo@utanet.at>

	* arch/unix/x11/gnome/ui.c (ui_open_canvas_window): Added Ettore's
	suggested fix for the BadMatch problem on Solaris. 

	* arch/unix/x11/video.c (video_register_raster): Replaced
	`USE_XF86_EXTENSIONS' with `USE_XF86_DGA2_EXTENSIONS'.
	(video_canvas_refresh): Likewise.

	* arch/unix/x11/gnome/ui.c: Fixed include for `vsiduiunix.h'.

	* arch/unix/x11/gnome/uicolor.c (uicolor_alloc_color): Replace
	PIXEL by BYTE.

	* arch/unix/vsidui.c (vsid_ui_init): attach handlers to window;
	this fixes the nonworking hotkeys for Xaw.

2002-01-27  Thomas Bretz  <tbretz@physik.tu-muenchen.de>

	* arch/os2/install.cmd:
	- removed 'Evaluation'
   
	* arch/os2/makedist.cmd:
	- changed to new paths
	- added "del vice2.zip"
   
	* arch/os2/vac++/RESID.ICC:
	- changed to version 0.13
   
	* arch/os2/video.c:
	- removed wmvrndisabled from set_stretch_factor
	- removed video_frame_buffer_*
	- changed functions from using frame_buffer to draw_buffer
   
	* raster/raster.c, src/screenshot.h, src/video.h:
	- added draw_buffer_height to calls of video_canvas_refresh
	for OS/2 (needed to make 100% sure, that we don't read behind
	the buffer, will be removed again as soon as the whole new
	video/pal, etc stuff is working completely)

2002-01-27  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.6.

	* vicii/vicii.c (vic_ii_update_video_mode): Propagate changes
	of multicolor mode one cycle faster.

	* arch/unix/x11/video.c, arch/unix/x11/videoarch.h,
	arch/unix/x11/ui-resources.c, arch/unix/x11/uihotkey.c,
	arch/unix/x11/ui-cmdline-options.c: Fixed some includes.

	* arch/unix/x11/xaw/ui.c, arch/unix/x11/gnome/ui.c
	(ui_init_finish): Read selected display depth from resource.

	* arch/unix/x11/video.c, arch/unix/x11/xaw/x11video.c,
	arch/unix/x11/gnome/gnomevideo.c, arch/unix/x11/videoarch.h:
	Removed unused depth parameter from `video_convert_func()'.

	* arch/win32/msvc/config.h, arch/riscos/config.h,
	arch/os2/config.h, raster/raster.c: Removed remaining
	`VIDEO_DISPLAY_DEPTH' defines.

	* arch/unix/x11/xaw/uicolor.c, arch/unix/x11/gnome/uicolor.c,
	arch/unix/x11/video.c, arch/unix/x11/videoarch.h: Use depth
	specified in the canvas.

2002-01-27  Dag Lem  <resid@nimrod.no>

	* arch/unix/x11/Makefile.am: Added renderXv.c, renderXv.h.

	* arch/unix/x11/renderXv.c, arch/unix/x11/renderXv.h: New
	files, X Video rendering.

	* arch/unix/x11/video.c: Added X Video handling.

	* arch/unix/x11/videoarch.h: Likewise.

	* arch/unix/x11/xaw/x11video.c: Likewise.

	* raster/raster.c (raster_init): Call video_register_raster
	for X Video.

	* video/video-color.c (video_calc_ycbcrtable): Build YUV table
	for X Video rendering.

2002-01-26  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.5.

	* arch/unix/x11/video.c, arch/unix/x11/xaw/x11video.c,
	arch/unix/x11/gnome/gnomevideo.c, video.h, raster/raster.c,
	arch/unix/x11/videoarch.h, arch/win32/video.c,
	arch/msdos/video.c, arch/riscos/video.c, arch/os2/video.c,
	arch/beos/video.cc, raster/raster.h, screenshot.h,
	arch/win32/videoarch.h, arch/msdos/videoarch.h,
	arch/beos/videoarch.h, arch/msdos/statusbar.h: Removed
	redundant video frame buffer API.

	arch/unix/x11/xaw/uicolor.c, arch/unix/x11/gnome/uicolor.c,
	uicolor.h, color.c, arch/unix/x11/videoarch.h,
	arch/unix/x11/video.c, arch/unix/x11/xaw/x11video.c,
	arch/unix/types.h, arch/win32/types.h, arch/msdos/types.h,
	arch/riscos/types.h, arch/os2/types.h, arch/beos/types.h:
	Removed obsolete `PIXEL' support.

2002-01-25  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.4.

	* raster/raster.c, raster/raster.h, raster-sprite-status.h,
	video.h, arch/unix/x11/video.c, arch/win32/video.c,
	arch/msdos/video.c, arch/riscos/video.c, arch/os2/video.c,
	arch/beos/video.cc, vicii/vicii-draw.c, vicii/vicii-sprites.c,
	crtc/crtc-draw.c, vic20/vic-draw.c, vic20/vic.h,
	plus4/ted-draw.c, screenshot.h, arch/unix/x11/xaw/ui.c,
	arch/unix/x11/gnome/ui.c, arch/unix/x11/xaw/uicolor.c,
	arch/unix/ui.h, uicolor.h, screenshot.c, color.c, color.h:
	Removed support for variable pixel size as the draw buffer
	uses 8bpp all the time now.

2002-01-24  Dag Lem  <resid@nimrod.no>

	* arch/unix/plus4ui.c: Removed #if VIDEO_DISPLAY_DEPTH == 0

	* arch/unix/uivicii.c: Likewise

	* arch/unix/x11/gnome/uicolor.c: Likewise

	* arch/unix/x11/xaw/uicolor.c: Likewise

	* arch/unix/x11/video.c: Make VIDEO_DISPLAY_DEPTH != 0 almost
	work.

	* arch/unix/x11/videoarch.c: Removed VIDEO_FRAME_BUFFER_xxx
	macros.

2002-01-24  Andreas Matthies  <andreas.matthies@gmx.net>

	* arch/beos/videoarch.h,video.cc, msdos/videoarch.h,video.c:
	Removed obsolete video_frame_buffer stuff. Adapted call off
	video_render_main.

	* arch/win32/plus4.dsp: Updated files for plus4 library.

	* arch/win32/vice.dsw: xplus4 doesn't depent on sid and resid.

2002-01-22  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.3.

	* arch/win32/video.c (video_canvas_refresh, real_refresh): Use
	draw buffer.
	(video_frame_buffer_alloc, video_frame_buffer_free,
	video_frame_buffer_clear): Removed temp frame buffer code.
	(video_frame_buffer_translate): Removed.

	* arch/win32/fullscreen.c (SwitchToFullscreenMode,
	SwitchToWindowedMode): Removed call to
	`video_frame_buffer_translate()'.

	* arch/win32/videoarch.h: Removed `VIDEO_FRAME_BUFFER_*'
	macros.

	* plus4/plus4mem.c (fdxx_read, fdxx_store): Only call ACIA if
	the arch supports RS232.

2002-01-22  Andreas Boose  <boose@linux.rz.fh-hannover.de>

	* Version 1.8.2.

	* raster/raster.c, vicii/vicii-draw.c, vdc/vdc-draw.c,
	crtc/crtc-draw.c, vic20/vic-draw.c, plus4/ted-draw.c,
	arch/unix/x11/videoarch.h, arch/riscos/videoarch.h, video.h,
	arch/unix/x11/video.c, arch/win32/video.c, arch/msdos/video.c,
	arch/riscos/video.c, arch/os2/unused/video_gpi.h,
	arch/os2/unused/video_gpi.c, arch/os2/video.c: Allocate draw
	buffer in the raster layer instead of allocating it the
	architecture dependent code.

	arch/unix/x11/video.c (video_canvas_refresh, convert_8to8,
	convert_8to16, convert_8to32, convert_8to1_dither,
	convert_8toall): Changed to new API.

	* screenshot.h: Added new members to `screenshot_t'.

	* screenshot.c (screenshot_line_data): Use draw buffer.

	* raster/raster.c, raster/raster.h, arch/win32/video.c,
	vicii/vicii.c, vdc/vdc.c, crtc/crtc.c, vic20/vic.c,
	plus4/ted.c: `raster_set_geometry()' takes separate extra
	border offsets for the left and right side now.

2002-01-21  Andreas Boose  <boose@linux.rz.fh-hannover.de>

        * Version 1.8.1.

	* vicii/vicii-draw.c (get_mc_text, get_ext_text): Fixed color
	register usage.

	* video/video-render.c, raster/raster.c, vicii/vicii-draw.c,
	vicii/vicii-sprites.c, crtc/crtc-draw.c, vic20/vic-draw.c,
	vic20/vic-mem.c, vic20/vic.c, vic20/vic.h, plus4/ted-draw.c,
	arch/win32/video.c, arch/unix/x11/gnome/gnomevideo.c,
	arch/unix/x11/xaw/x11video.c, vice.h: Removed chip specific
	double size modes.

	* plus4/plus4mem.c, plus4/plus4mem.c (mem_load_3plus1lo,
	mem_load_3plus1hi): New functions.
	(mem_load): Load 3plus1 ROM images.
	(fdxx_read, fdxx_store): Fixed function names, added ACIA
	register support.

	* plus4/plus4pio2.c, plus4/plus4pio2.h: New files.
	Renamed from plustia1.c and plustia1.h, fixed function names.

	* plus4/plus4acia.c, plus4/plus4acia.h: New files.

	* plus4/ted-mem.c (ted08_store): Fixed function names.

	* plus4/plus4-resources.c: New resources for 3plus1 ROMs.

	* plus4/plus4-cmdline-options.c: New command line options for
	3plus1 ROMs.

	* plus4/plus4.c: Added ACIA resource, command line options,
	initialization and reset functions.

	* plus4/Makefile.am: Added new files.

	* drive/drive-resources.c: New resources for 1551 ROM.

	* drive/drive-cmdline-options.c: New command line options for
	1551 ROM.

	* drive/drive.c (drive_load_1551): New function.
	(drive_set_disk_drive_type): Load 1551 ROM.

	* drive/drive.h: Added new 1551 constants and prototypes.

